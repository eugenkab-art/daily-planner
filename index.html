<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üìì –ú–æ–π –ï–∂–µ–¥–Ω–µ–≤–Ω–∏–∫</title>
    <style>
        /* –õ–µ–≥–∫–∏–π –±–µ–∂–µ–≤—ã–π —Ñ–æ–Ω –≤–æ–∫—Ä—É–≥ */
        body { 
            font-family: 'Arial', sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px;
            background-color: #f8f5f0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(120, 119, 116, 0.03) 3px, transparent 0),
                radial-gradient(circle at 90% 80%, rgba(120, 119, 116, 0.02) 2px, transparent 0);
            background-size: 80px 80px, 60px 60px;
            min-height: 100vh;
            position: relative;
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç –ª–∏—Å—Ç–∞ –±—É–º–∞–≥–∏ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .paper-container {
            background: #fffdf8;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 
                0 8px 25px rgba(139, 115, 85, 0.15),
                0 0 0 1px rgba(139, 115, 85, 0.1),
                inset 0 0 30px rgba(139, 115, 85, 0.05);
            position: relative;
            min-height: 600px;
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–≥–Ω—É—Ç–æ–≥–æ —É–≥–ª–∞ */
        .paper-container::before {
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, transparent 50%, rgba(139, 115, 85, 0.1) 50%);
            border-radius: 0 0 0 12px;
            pointer-events: none;
        }
        
        .auth-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .auth-form {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .auth-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 150px;
        }
        
        .auth-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        
        .user-info {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 6px;
        }
        
        .logout-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #ff5252;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .date-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .date-picker {
            padding: 12px;
            font-size: 16px;
            border: 2px solid #8B7355;
            border-radius: 8px;
            text-align: center;
            background: white;
            box-shadow: 0 2px 8px rgba(139, 115, 85, 0.2);
        }
        
        .nav-btn {
            background: #8B7355;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #667eea;
            transform: scale(1.1);
        }
        
        .note-form {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .note-input {
            flex: 1;
            max-width: 400px;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #8B7355;
            border-radius: 8px;
            background: white;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .add-btn {
            padding: 12px 24px;
            font-size: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .notes-container {
            position: relative;
            min-height: 400px;
        }
        
        .notes-list {
            list-style: none;
            padding: 0;
            margin: 0;
            background-image: linear-gradient(to bottom, 
                transparent 39px, 
                #e8dfd0 39px,
                #e8dfd0 40px, 
                transparent 40px
            );
            background-size: 100% 40px;
            background-position: 0 0;
            min-height: 400px;
            border: 1px solid #d6c9b8;
            border-radius: 8px;
            padding: 0 20px;
            background-color: #fffdf8;
            box-shadow: inset 0 0 20px rgba(139, 115, 85, 0.05);
        }
        
        .note-item {
            display: flex;
            align-items: center;
            height: 40px;
            gap: 15px;
            padding: 0;
            margin: 0;
            transition: all 0.3s ease;
        }
        
        .note-item:hover {
            background: rgba(139, 115, 85, 0.05);
        }
        
        .note-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #8B7355;
            border-radius: 4px;
            appearance: none;
            position: relative;
            flex-shrink: 0;
            background: white;
        }
        
        .note-checkbox:checked {
            background: #8B7355;
            border-color: #8B7355;
            transform: scale(1.1);
            animation: pop 0.4s ease;
        }
        
        .note-checkbox:checked::after {
            content: '‚úì';
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            font-weight: bold;
        }
        
        @keyframes pop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1.1); }
        }
        
        .note-text {
            flex: 1;
            font-size: 16px;
            padding: 0;
            transition: all 0.3s ease;
            line-height: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
        
        .note-text.completed {
            text-decoration: line-through;
            color: #888;
            opacity: 0.7;
        }
        
        .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 4px 8px;
            border-radius: 4px;
            opacity: 0.7;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .delete-btn:hover {
            opacity: 1;
            background-color: #ffebee;
            transform: scale(1.1);
        }
        
        .empty-state {
            text-align: center;
            color: #888;
            font-style: italic;
            line-height: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* –°—Ç—Ä–µ–ª–æ—á–∫–∏ –≤ —É–≥–ª–∞—Ö */
        .corner-nav {
            position: fixed;
            z-index: 100;
        }
        
        .corner-nav.prev-day {
            bottom: 20px;
            left: 20px;
        }
        
        .corner-nav.next-day {
            bottom: 20px;
            right: 20px;
        }
        
        .corner-btn {
            width: 50px;
            height: 50px;
            background: #8B7355;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .corner-btn:hover {
            background: #667eea;
            transform: scale(1.1);
        }
        
        .hidden {
            display: none;
        }

        .error-message {
            color: #ff6b6b;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 4px;
            border: 1px solid #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="paper-container">
        <!-- –°–µ–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div id="authSection" class="auth-section">
            <h2>üìì –í–æ–π–¥–∏—Ç–µ –≤ –µ–∂–µ–¥–Ω–µ–≤–Ω–∏–∫</h2>
            <div class="auth-form">
                <input type="text" id="username" class="auth-input" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                <input type="password" id="password" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å">
                <button id="loginBtn" class="auth-btn">–í–æ–π—Ç–∏</button>
                <button id="registerBtn" class="auth-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
            <div id="authError" class="error-message hidden"></div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å–∫—Ä—ã—Ç –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
        <div id="mainContent" class="hidden">
            <div class="user-info">
                –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <span id="currentUser"></span>
                <button id="logoutBtn" class="logout-btn">–í—ã–π—Ç–∏</button>
            </div>
            
            <div class="header">
                <h1>üìì –ú–æ–π –ï–∂–µ–¥–Ω–µ–≤–Ω–∏–∫</h1>
            </div>
            
            <div class="date-navigation">
                <button class="nav-btn prev-day-btn">‚Üê</button>
                <input type="date" id="datePicker" class="date-picker">
                <button class="nav-btn next-day-btn">‚Üí</button>
            </div>
            
            <form class="note-form" id="noteForm">
                <input type="text" id="noteInput" class="note-input" placeholder="–î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞—á—É –Ω–∞ —Å–µ–≥–æ–¥–Ω—è..." required>
                <button type="submit" class="add-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
            
            <div class="notes-container">
                <ul id="notesList" class="notes-list"></ul>
            </div>
        </div>
    </div>
    
    <!-- –°—Ç—Ä–µ–ª–æ—á–∫–∏ –≤ —É–≥–ª–∞—Ö -->
    <div class="corner-nav prev-day">
        <button class="corner-btn prev-day-corner">‚Üê</button>
    </div>
    <div class="corner-nav next-day">
        <button class="corner-btn next-day-corner">‚Üí</button>
    </div>

<script>
    console.log('üöÄ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω - –í–ï–†–°–ò–Ø –° –°–û–•–†–ê–ù–ï–ù–ò–ï–ú –°–ï–°–°–ò–ò');
    
    let currentToken = null;
    let currentUser = null;
    
    // –≠–ª–µ–º–µ–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    const authSection = document.getElementById('authSection');
    const mainContent = document.getElementById('mainContent');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const currentUserSpan = document.getElementById('currentUser');
    const authError = document.getElementById('authError');
    
    // –≠–ª–µ–º–µ–Ω—Ç—ã –µ–∂–µ–¥–Ω–µ–≤–Ω–∏–∫–∞
    const form = document.getElementById('noteForm');
    const input = document.getElementById('noteInput');
    const list = document.getElementById('notesList');
    const datePicker = document.getElementById('datePicker');
    const prevDayBtn = document.querySelector('.prev-day-btn');
    const nextDayBtn = document.querySelector('.next-day-btn');
    const prevDayCorner = document.querySelector('.prev-day-corner');
    const nextDayCorner = document.querySelector('.next-day-corner');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã
    console.log('üìù –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', {
        authSection: !!authSection,
        mainContent: !!mainContent,
        usernameInput: !!usernameInput,
        passwordInput: !!passwordInput,
        loginBtn: !!loginBtn,
        registerBtn: !!registerBtn,
        logoutBtn: !!logoutBtn,
        form: !!form,
        datePicker: !!datePicker
    });

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
    datePicker.value = new Date().toISOString().split('T')[0];
    
    // ==================== –°–û–•–†–ê–ù–ï–ù–ò–ï –°–ï–°–°–ò–ò ====================

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
    function saveAuthData(token, user) {
        localStorage.setItem('authToken', token);
        localStorage.setItem('userData', JSON.stringify(user));
        console.log('üíæ –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
    }

    function getAuthToken() {
        return localStorage.getItem('authToken');
    }

    function getUserData() {
        const userData = localStorage.getItem('userData');
        return userData ? JSON.parse(userData) : null;
    }

    function clearAuthData() {
        localStorage.removeItem('authToken');
        localStorage.removeItem('userData');
        console.log('üßπ –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—á–∏—â–µ–Ω—ã');
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
function checkSavedAuth() {
    const token = getAuthToken();
    const userData = getUserData();
    
    console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏:', { 
        hasToken: !!token, 
        hasUserData: !!userData 
    });
    
    if (token && userData) {
        console.log('‚úÖ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userData.username);
        
        // –í–û–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        currentToken = token;
        currentUser = userData;
        
        currentUserSpan.textContent = currentUser.username;
        authSection.classList.add('hidden');
        mainContent.classList.remove('hidden');
        loadNotes();
    } else {
        console.log('‚ÑπÔ∏è –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞');
    }
}

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
    function showAuthError(message) {
        authError.textContent = message;
        authError.classList.remove('hidden');
    }

    function hideAuthError() {
        authError.classList.add('hidden');
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —É—Å–ø–µ—à–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
    function handleAuthSuccess(data) {
        console.log('‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ');
        currentToken = data.token;
        currentUser = data.user;
        saveAuthData(data.token, data.user);
        currentUserSpan.textContent = currentUser.username;
        authSection.classList.add('hidden');
        mainContent.classList.remove('hidden');
        hideAuthError();
        loadNotes();
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é authenticate
    async function authenticate(endpoint) {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        console.log('üîê –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', { 
            endpoint, 
            username, 
            passwordLength: password.length 
        });
        
        if (!username || !password) {
            showAuthError('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å');
            return;
        }
        
        try {
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞:', endpoint);
            
            const response = await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            
            console.log('üì• –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω. –°—Ç–∞—Ç—É—Å:', response.status);
            
            const data = await response.json();
            console.log('üìä –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', data);
            
            if (response.ok) {
                handleAuthSuccess(data);
            } else {
                console.log('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', data.error);
                showAuthError(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
            }
        } catch (error) {
            console.error('üí• –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            showAuthError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message);
        }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤—ã—Ö–æ–¥–∞
    function setupLogout() {
        logoutBtn.addEventListener('click', () => {
            console.log('üö™ –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
            currentToken = null;
            currentUser = null;
            clearAuthData();
            authSection.classList.remove('hidden');
            mainContent.classList.add('hidden');
            list.innerHTML = '';
            usernameInput.value = '';
            passwordInput.value = '';
            hideAuthError();
        });
    }

    // ==================== –ï–ñ–ï–î–ù–ï–í–ù–ò–ö ====================
    
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–Ω—è–º
    function changeDate(days) {
        const currentDate = new Date(datePicker.value);
        currentDate.setDate(currentDate.getDate() + days);
        datePicker.value = currentDate.toISOString().split('T')[0];
        console.log('üìÖ –°–º–µ–Ω–∞ –¥–∞—Ç—ã –Ω–∞:', datePicker.value);
        loadNotes();
    }
    
    prevDayBtn.addEventListener('click', () => changeDate(-1));
    nextDayBtn.addEventListener('click', () => changeDate(1));
    prevDayCorner.addEventListener('click', () => changeDate(-1));
    nextDayCorner.addEventListener('click', () => changeDate(1));
    
    datePicker.addEventListener('change', () => {
        console.log('üìÖ –í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞:', datePicker.value);
        loadNotes();
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const text = input.value.trim();
        
        if (text) {
            console.log('‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏:', text);
            await addNote(text);
            input.value = '';
            await loadNotes();
        }
    });
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–º–µ—Ç–æ–∫
    async function loadNotes() {
        if (!currentToken) {
            console.log('‚ö†Ô∏è –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∑–∞–º–µ—Ç–æ–∫');
            return;
        }
        
        const date = datePicker.value;
        console.log('üìù –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–º–µ—Ç–æ–∫ –¥–ª—è –¥–∞—Ç—ã:', date);
        
        try {
            const response = await fetch(`/api/notes?date=${date}`, {
                headers: {
                    'Authorization': `Bearer ${currentToken}`
                }
            });
            
            console.log('üì• –û—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å –∑–∞–º–µ—Ç–æ–∫. –°—Ç–∞—Ç—É—Å:', response.status);
            
            if (response.status === 401) {
                console.log('‚ùå –¢–æ–∫–µ–Ω —É—Å—Ç–∞—Ä–µ–ª');
                clearAuthData();
                authSection.classList.remove('hidden');
                mainContent.classList.add('hidden');
                return;
            }
            
            const notes = await response.json();
            console.log('üìä –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–º–µ—Ç–æ–∫:', notes.length);
            renderNotes(notes);
        } catch (error) {
            console.error('üí• –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–æ–∫:', error);
        }
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
    async function addNote(text) {
        try {
            const response = await fetch('/api/notes', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${currentToken}`
                },
                body: JSON.stringify({ 
                    text, 
                    date: datePicker.value 
                })
            });
            
            console.log('üì• –û—Ç–≤–µ—Ç –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏. –°—Ç–∞—Ç—É—Å:', response.status);
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
            }

            console.log('‚úÖ –ó–∞–º–µ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
        } catch (error) {
            console.error('üí• –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏:', error);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–º–µ—Ç–∫–∏: ' + error.message);
        }
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫
    function renderNotes(notes) {
        console.log('üé® –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–∞–º–µ—Ç–æ–∫:', notes);
        list.innerHTML = '';
        
        if (notes.length === 0) {
            const emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            emptyState.textContent = '–ù–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –∑–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç...';
            list.appendChild(emptyState);
            return;
        }
        
        notes.forEach((note) => {
            const li = document.createElement('li');
            li.className = 'note-item';
            
            // –ß–µ–∫–±–æ–∫—Å
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'note-checkbox';
            checkbox.checked = !!note.done;
            
            checkbox.addEventListener('change', async () => {
                console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–º–µ—Ç–∫–∏:', note.id);
                await fetch(`/api/notes/${note.id}/toggle`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                loadNotes();
            });
            
            // –¢–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏
            const textSpan = document.createElement('span');
            textSpan.className = 'note-text';
            textSpan.textContent = note.text;
            if (note.done) {
                textSpan.classList.add('completed');
            }
            
            // –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
            const btn = document.createElement('button');
            btn.textContent = '‚ùå';
            btn.className = 'delete-btn';
            btn.addEventListener('click', async () => {
                console.log('üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏:', note.id);
                await fetch(`/api/notes/${note.id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });
                loadNotes();
            });
            
            li.appendChild(checkbox);
            li.appendChild(textSpan);
            li.appendChild(btn);
            list.appendChild(li);
        });
    }

    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    loginBtn.addEventListener('click', async () => {
        console.log('üñ±Ô∏è –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ –í–æ–π—Ç–∏');
        hideAuthError();
        await authenticate('/api/login');
    });

    registerBtn.addEventListener('click', async () => {
        console.log('üñ±Ô∏è –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è');
        hideAuthError();
        await authenticate('/api/register');
    });

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã—Ö–æ–¥–∞
    setupLogout();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é...');
        checkSavedAuth();
    });

    console.log('‚úÖ –í–ï–†–°–ò–Ø –° –°–û–•–†–ê–ù–ï–ù–ò–ï–ú –°–ï–°–°–ò–ò - –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã');
</script>
</body>
</html>